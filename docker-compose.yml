services:
  webiu-server:
    build:
      context: ./webiu-server
    container_name: webiu-server
    ports:
      - 5050:5050
    env_file:
      - ./webiu-server/.env
    environment:
      - NODE_ENV=production
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--spider", "-q", "http://localhost:5050/health"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s

  webiu-ui:
    build:
      context: ./webiu-ui
    container_name: webiu-ui
    ports:
      - 4200:4000
    environment:
      - PORT=4000
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--spider", "-q", "http://localhost:4000"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 15s
    depends_on:
      webiu-server:
        condition: service_healthy