<div style="padding: 20px">
  <div class="contributors-card-container">
    <i class="fa fa-spinner fa-spin loadspinner" *ngIf="loading"></i>
  </div>

  <div class="action-bar" *ngIf="!errorMessage && !loading">
    <div class="toggle-buttons">
      <button
        (click)="toggleView('issues')"
        [class.active]="activeView === 'issues'"
        class="toggle-button"
      >
        <i class="fas fa-circle-notch icon-gap"></i> Issues Created:
        {{ filteredIssues.length }}
      </button>
      <button
        (click)="toggleView('pullRequests')"
        [class.active]="activeView === 'pullRequests'"
        class="toggle-button"
      >
        <i class="fas fa-code-branch icon-gap"></i> Pull Requests:
        {{ filteredPullRequests.length }}
      </button>
    </div>
    <div class="filter-section">
      <p class="filter-name">Filter by repo</p>
      <select class="repository-select" (change)="onRepoFilterChange($event)">
        <option value="">All</option>
        <option *ngFor="let repo of uniqueRepositories" [value]="repo">
          {{ repo }}
        </option>
      </select>
    </div>
  </div>

  <div class="main-container">
    <div *ngIf="userProfile" class="user-profile">
      <img
        [src]="userProfile.avatar_url"
        alt="Profile Picture"
        class="profile-picture"
      />
      <h3 class="username">{{ userProfile.login }}</h3>
      <button
        (click)="openGitHubProfile(userProfile.html_url)"
        class="github-button"
      >
        <i class="fab fa-github github-icon"></i>
        <span class="username">{{ userProfile.login }}</span>
      </button>
    </div>

    <div *ngIf="activeView === 'issues'" class="data-section">
      <ul
        class="data-list"
        *ngIf="filteredIssues.length > 0; else noIssuesMessage"
      >
        <li *ngFor="let issue of filteredIssues" class="data-item">
          <ng-container *ngIf="issue.closed_at; else openIssue">
            <i class="far fa-check-circle icon-closed"></i>
          </ng-container>
          <ng-template #openIssue>
            <i class="fas fa-circle-notch icon-open"></i>
          </ng-template>
          <a [href]="issue.html_url" target="_blank" rel="noopener noreferrer">
            {{ issue.title }}
          </a>
          <p>{{ formatLastUpdated(issue.updated_at) }}</p>
        </li>
      </ul>
      <ng-template #noIssuesMessage>
        <p class="no-data-message" *ngIf="!loading && !errorMessage">
          No issues found for this contributor
        </p>
      </ng-template>
    </div>

    <div *ngIf="activeView === 'pullRequests'" class="data-section">
      <ul
        class="data-list"
        *ngIf="filteredPullRequests.length > 0; else noPullRequestMessage"
      >
        <li *ngFor="let pr of filteredPullRequests" class="data-item">
          <i class="fa-solid fa-code-pull-request icon-open"></i>
          <a [href]="pr.html_url" target="_blank" rel="noopener noreferrer">
            {{ pr.title }}
          </a>
          <p>{{ formatLastUpdated(pr.updated_at) }}</p>
        </li>
      </ul>
      <ng-template #noPullRequestMessage>
        <p class="no-data-message" *ngIf="!loading && !errorMessage">
          No pull requests found for this contributor
        </p>
      </ng-template>
    </div>
  </div>

  <p
    *ngIf="
      !loading &&
      !hasData &&
      !filteredIssues.length &&
      !filteredPullRequests.length
    "
    class="error-message"
  >
    {{ errorMessage }}
  </p>
</div>
