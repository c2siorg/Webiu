<div class="search-page">
  <!-- Loading Spinner -->
  <app-loading-spinner *ngIf="loading" message="Fetching contributor data..."></app-loading-spinner>

  <!-- Error Message -->
  <div class="error-container" *ngIf="errorMessage && !loading">
    <i class="fas fa-exclamation-triangle error-icon"></i>
    <p class="error-text">{{ errorMessage }}</p>
  </div>

  <!-- Main Content -->
  <div class="content-wrapper" *ngIf="!loading && !errorMessage && userProfile">
    <!-- Sidebar: Profile Card -->
    <aside class="sidebar">
      <div class="profile-card">
        <img [src]="userProfile.avatar_url" alt="{{ userProfile.login }}'s avatar" class="profile-avatar" />
        <h2 class="profile-name">{{ userProfile.name || userProfile.login }}</h2>
        <p class="profile-login" *ngIf="userProfile.name">&#64;{{ userProfile.login }}</p>
        <p class="profile-bio" *ngIf="userProfile.bio">{{ userProfile.bio }}</p>

        <button (click)="openGitHubProfile(userProfile.html_url)" class="github-link-btn">
          <i class="fab fa-github"></i>
          <span>View on GitHub</span>
        </button>

        <!-- Profile Meta -->
        <div class="profile-meta">
          <div class="meta-item" *ngIf="userProfile.location">
            <i class="fas fa-map-marker-alt"></i>
            <span>{{ userProfile.location }}</span>
          </div>
          <div class="meta-item" *ngIf="memberSince">
            <i class="fas fa-calendar-alt"></i>
            <span>Member since {{ memberSince }}</span>
          </div>
          <div class="meta-item">
            <i class="fas fa-users"></i>
            <span>{{ userProfile.followers }} followers &middot; {{ userProfile.following }} following</span>
          </div>
        </div>

        <!-- Stats -->
        <div class="profile-stats">
          <div class="stat">
            <span class="stat-value">{{ issues.length }}</span>
            <span class="stat-label">Issues</span>
          </div>
          <div class="stat">
            <span class="stat-value">{{ pullRequests.length }}</span>
            <span class="stat-label">PRs</span>
          </div>
          <div class="stat">
            <span class="stat-value">{{ uniqueRepositories.length }}</span>
            <span class="stat-label">Repos</span>
          </div>
        </div>

        <!-- Open / Closed Breakdown -->
        <div class="breakdown-section">
          <h4 class="breakdown-title">Issues Breakdown</h4>
          <div class="breakdown-bar">
            <div class="bar-segment open" [style.width.%]="issues.length ? (openIssues / issues.length) * 100 : 0">
            </div>
            <div class="bar-segment closed" [style.width.%]="issues.length ? (closedIssues / issues.length) * 100 : 0">
            </div>
          </div>
          <div class="breakdown-legend">
            <span class="legend-item"><i class="fas fa-circle open-dot"></i> {{ openIssues }} Open</span>
            <span class="legend-item"><i class="fas fa-circle closed-dot"></i> {{ closedIssues }} Closed</span>
          </div>

          <h4 class="breakdown-title" style="margin-top: 16px;">PR Breakdown</h4>
          <div class="breakdown-bar">
            <div class="bar-segment pr-open"
              [style.width.%]="pullRequests.length ? (openPRs / pullRequests.length) * 100 : 0"></div>
            <div class="bar-segment pr-closed"
              [style.width.%]="pullRequests.length ? (mergedOrClosedPRs / pullRequests.length) * 100 : 0"></div>
          </div>
          <div class="breakdown-legend">
            <span class="legend-item"><i class="fas fa-circle pr-open-dot"></i> {{ openPRs }} Open</span>
            <span class="legend-item"><i class="fas fa-circle pr-closed-dot"></i> {{ mergedOrClosedPRs }}
              Merged/Closed</span>
          </div>
        </div>
      </div>
    </aside>

    <!-- Main Area -->
    <main class="main-area">
      <!-- Toolbar: Tabs + Filters -->
      <div class="toolbar">
        <div class="tabs">
          <button (click)="toggleView('issues')" [class.active]="activeView === 'issues'" class="tab-btn">
            <i class="fas fa-dot-circle"></i>
            <span>Issues</span>
            <span class="badge">{{ filteredIssues.length }}</span>
          </button>
          <button (click)="toggleView('pullRequests')" [class.active]="activeView === 'pullRequests'" class="tab-btn">
            <i class="fas fa-code-branch"></i>
            <span>Pull Requests</span>
            <span class="badge">{{ filteredPullRequests.length }}</span>
          </button>
        </div>

        <div class="filter-controls">
          <div class="filter-dropdown">
            <label for="statusFilter">Status</label>
            <select id="statusFilter" (change)="onStatusFilterChange($event)">
              <option value="">All</option>
              <option value="open">Open</option>
              <option value="merged">Merged</option>
              <option value="closed">Closed</option>
              <option value="draft">Draft</option>
            </select>
          </div>

          <div class="filter-dropdown">
            <label for="repoFilter">Repository</label>
            <select id="repoFilter" (change)="onRepoFilterChange($event)">
              <option value="">All repositories</option>
              <option *ngFor="let repo of uniqueRepositories" [value]="repo">
                {{ repo }}
              </option>
            </select>
          </div>

          <div class="filter-dropdown">
            <label for="sortBy">Sort By</label>
            <select id="sortBy" (change)="onSortChange($event)">
              <option value="updated-desc">Recently Updated</option>
              <option value="updated-asc">Least Recently Updated</option>
              <option value="created-desc">Newest First</option>
              <option value="created-asc">Oldest First</option>
              <option value="title-asc">Title (A-Z)</option>
              <option value="title-desc">Title (Z-A)</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Issues List -->
      <div *ngIf="activeView === 'issues'" class="items-list">
        <div *ngFor="let issue of filteredIssues" class="list-item">
          <div class="item-icon" [ngClass]="issue.closed_at ? 'closed' : 'open'">
            <i [class]="issue.closed_at ? 'fas fa-check-circle' : 'fas fa-dot-circle'"></i>
          </div>
          <div class="item-content">
            <a [href]="issue.html_url" target="_blank" rel="noopener noreferrer" class="item-title">
              {{ issue.title }}
            </a>
            <span class="item-meta">Updated {{ formatLastUpdated(issue.updated_at) }}</span>
          </div>
        </div>

        <div class="empty-state" *ngIf="filteredIssues.length === 0">
          <i class="fas fa-inbox"></i>
          <p>No issues found for this contributor</p>
        </div>
      </div>

      <!-- Pull Requests List -->
      <div *ngIf="activeView === 'pullRequests'" class="items-list">
        <div *ngFor="let pr of filteredPullRequests" class="list-item">
          <div class="item-icon pr">
            <i class="fas fa-code-branch"></i>
          </div>
          <div class="item-content">
            <a [href]="pr.html_url" target="_blank" rel="noopener noreferrer" class="item-title">
              {{ pr.title }}
            </a>
            <span class="item-meta">Updated {{ formatLastUpdated(pr.updated_at) }}</span>
          </div>
        </div>

        <div class="empty-state" *ngIf="filteredPullRequests.length === 0">
          <i class="fas fa-inbox"></i>
          <p>No pull requests found for this contributor</p>
        </div>
      </div>
    </main>
  </div>
</div>